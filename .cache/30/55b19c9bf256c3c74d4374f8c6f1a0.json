{"id":"node_modules/webcola/dist/src/layout3d.js","dependencies":[{"name":"/Users/reza/Documents/Meteor/Force Directed Graph/Graph/node_modules/webcola/dist/src/layout3d.js.map","includedInParent":true,"mtime":1517462217000},{"name":"/Users/reza/Documents/Meteor/Force Directed Graph/Graph/node_modules/webcola/WebCola/src/layout3d.ts","includedInParent":true,"mtime":1516884256000},{"name":"/Users/reza/Documents/Meteor/Force Directed Graph/Graph/package.json","includedInParent":true,"mtime":1550967406043},{"name":"/Users/reza/Documents/Meteor/Force Directed Graph/Graph/node_modules/webcola/package.json","includedInParent":true,"mtime":1550967405642},{"name":"./shortestpaths","loc":{"line":3,"column":30},"parent":"/Users/reza/Documents/Meteor/Force Directed Graph/Graph/node_modules/webcola/dist/src/layout3d.js","resolved":"/Users/reza/Documents/Meteor/Force Directed Graph/Graph/node_modules/webcola/dist/src/shortestpaths.js"},{"name":"./descent","loc":{"line":4,"column":24},"parent":"/Users/reza/Documents/Meteor/Force Directed Graph/Graph/node_modules/webcola/dist/src/layout3d.js","resolved":"/Users/reza/Documents/Meteor/Force Directed Graph/Graph/node_modules/webcola/dist/src/descent.js"},{"name":"./rectangle","loc":{"line":5,"column":26},"parent":"/Users/reza/Documents/Meteor/Force Directed Graph/Graph/node_modules/webcola/dist/src/layout3d.js","resolved":"/Users/reza/Documents/Meteor/Force Directed Graph/Graph/node_modules/webcola/dist/src/rectangle.js"},{"name":"./linklengths","loc":{"line":6,"column":28},"parent":"/Users/reza/Documents/Meteor/Force Directed Graph/Graph/node_modules/webcola/dist/src/layout3d.js","resolved":"/Users/reza/Documents/Meteor/Force Directed Graph/Graph/node_modules/webcola/dist/src/linklengths.js"}],"generated":{"js":"\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar shortestpaths_1 = require(\"./shortestpaths\");\r\nvar descent_1 = require(\"./descent\");\r\nvar rectangle_1 = require(\"./rectangle\");\r\nvar linklengths_1 = require(\"./linklengths\");\r\nvar Link3D = (function () {\r\n    function Link3D(source, target) {\r\n        this.source = source;\r\n        this.target = target;\r\n    }\r\n    Link3D.prototype.actualLength = function (x) {\r\n        var _this = this;\r\n        return Math.sqrt(x.reduce(function (c, v) {\r\n            var dx = v[_this.target] - v[_this.source];\r\n            return c + dx * dx;\r\n        }, 0));\r\n    };\r\n    return Link3D;\r\n}());\r\nexports.Link3D = Link3D;\r\nvar Node3D = (function () {\r\n    function Node3D(x, y, z) {\r\n        if (x === void 0) { x = 0; }\r\n        if (y === void 0) { y = 0; }\r\n        if (z === void 0) { z = 0; }\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n    }\r\n    return Node3D;\r\n}());\r\nexports.Node3D = Node3D;\r\nvar Layout3D = (function () {\r\n    function Layout3D(nodes, links, idealLinkLength) {\r\n        if (idealLinkLength === void 0) { idealLinkLength = 1; }\r\n        var _this = this;\r\n        this.nodes = nodes;\r\n        this.links = links;\r\n        this.idealLinkLength = idealLinkLength;\r\n        this.constraints = null;\r\n        this.useJaccardLinkLengths = true;\r\n        this.result = new Array(Layout3D.k);\r\n        for (var i = 0; i < Layout3D.k; ++i) {\r\n            this.result[i] = new Array(nodes.length);\r\n        }\r\n        nodes.forEach(function (v, i) {\r\n            for (var _i = 0, _a = Layout3D.dims; _i < _a.length; _i++) {\r\n                var dim = _a[_i];\r\n                if (typeof v[dim] == 'undefined')\r\n                    v[dim] = Math.random();\r\n            }\r\n            _this.result[0][i] = v.x;\r\n            _this.result[1][i] = v.y;\r\n            _this.result[2][i] = v.z;\r\n        });\r\n    }\r\n    ;\r\n    Layout3D.prototype.linkLength = function (l) {\r\n        return l.actualLength(this.result);\r\n    };\r\n    Layout3D.prototype.start = function (iterations) {\r\n        var _this = this;\r\n        if (iterations === void 0) { iterations = 100; }\r\n        var n = this.nodes.length;\r\n        var linkAccessor = new LinkAccessor();\r\n        if (this.useJaccardLinkLengths)\r\n            linklengths_1.jaccardLinkLengths(this.links, linkAccessor, 1.5);\r\n        this.links.forEach(function (e) { return e.length *= _this.idealLinkLength; });\r\n        var distanceMatrix = (new shortestpaths_1.Calculator(n, this.links, function (e) { return e.source; }, function (e) { return e.target; }, function (e) { return e.length; })).DistanceMatrix();\r\n        var D = descent_1.Descent.createSquareMatrix(n, function (i, j) { return distanceMatrix[i][j]; });\r\n        var G = descent_1.Descent.createSquareMatrix(n, function () { return 2; });\r\n        this.links.forEach(function (_a) {\r\n            var source = _a.source, target = _a.target;\r\n            return G[source][target] = G[target][source] = 1;\r\n        });\r\n        this.descent = new descent_1.Descent(this.result, D);\r\n        this.descent.threshold = 1e-3;\r\n        this.descent.G = G;\r\n        if (this.constraints)\r\n            this.descent.project = new rectangle_1.Projection(this.nodes, null, null, this.constraints).projectFunctions();\r\n        for (var i = 0; i < this.nodes.length; i++) {\r\n            var v = this.nodes[i];\r\n            if (v.fixed) {\r\n                this.descent.locks.add(i, [v.x, v.y, v.z]);\r\n            }\r\n        }\r\n        this.descent.run(iterations);\r\n        return this;\r\n    };\r\n    Layout3D.prototype.tick = function () {\r\n        this.descent.locks.clear();\r\n        for (var i = 0; i < this.nodes.length; i++) {\r\n            var v = this.nodes[i];\r\n            if (v.fixed) {\r\n                this.descent.locks.add(i, [v.x, v.y, v.z]);\r\n            }\r\n        }\r\n        return this.descent.rungeKutta();\r\n    };\r\n    Layout3D.dims = ['x', 'y', 'z'];\r\n    Layout3D.k = Layout3D.dims.length;\r\n    return Layout3D;\r\n}());\r\nexports.Layout3D = Layout3D;\r\nvar LinkAccessor = (function () {\r\n    function LinkAccessor() {\r\n    }\r\n    LinkAccessor.prototype.getSourceIndex = function (e) { return e.source; };\r\n    LinkAccessor.prototype.getTargetIndex = function (e) { return e.target; };\r\n    LinkAccessor.prototype.getLength = function (e) { return e.length; };\r\n    LinkAccessor.prototype.setLength = function (e, l) { e.length = l; };\r\n    return LinkAccessor;\r\n}());\r\n","map":{"version":3,"file":"layout3d.js","sourceRoot":"","sources":["../../WebCola/src/layout3d.ts"],"names":[],"mappings":"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","sourcesContent":["import {Calculator} from './shortestpaths'\r\nimport {Descent} from './descent'\r\nimport {Projection, GraphNode, Rectangle} from './rectangle'\r\nimport {Variable} from './vpsc'\r\nimport {jaccardLinkLengths, LinkLengthAccessor} from './linklengths'\r\n\r\nexport class Link3D {\r\n        length: number;\r\n        constructor(public source: number, public target: number) { }\r\n        actualLength(x: number[][]) {\r\n            return Math.sqrt(\r\n                x.reduce((c: number, v: number[]) => {\r\n                    const dx = v[this.target] - v[this.source];\r\n                    return c + dx * dx;\r\n                }, 0));\r\n        }\r\n    }\r\n    export class Node3D implements GraphNode {\r\n        // if fixed, layout will not move the node from its specified starting position\r\n        fixed: boolean;\r\n        width: number;\r\n        height: number;\r\n        px: number;\r\n        py: number;\r\n        bounds: Rectangle;\r\n        variable: Variable;\r\n        constructor(\r\n            public x: number = 0,\r\n            public y: number = 0,\r\n            public z: number = 0) { }\r\n    }\r\n    export class Layout3D {\r\n        static dims = ['x', 'y', 'z'];\r\n        static k = Layout3D.dims.length;\r\n        result: number[][];\r\n        constraints: any[] = null;\r\n\r\n        constructor(public nodes: Node3D[], public links: Link3D[], public idealLinkLength: number = 1) {\r\n            this.result = new Array(Layout3D.k);\r\n            for (var i = 0; i < Layout3D.k; ++i) {\r\n                this.result[i] = new Array(nodes.length);\r\n            }\r\n            nodes.forEach((v, i) => {\r\n                for (var dim of Layout3D.dims) {\r\n                    if (typeof v[dim] == 'undefined') v[dim] = Math.random();\r\n                }\r\n                this.result[0][i] = v.x;\r\n                this.result[1][i] = v.y;\r\n                this.result[2][i] = v.z;\r\n            });\r\n        };\r\n\r\n        linkLength(l: Link3D): number {\r\n            return l.actualLength(this.result);\r\n        }\r\n\r\n        useJaccardLinkLengths: boolean = true;\r\n\r\n        descent: Descent;\r\n        start(iterations: number = 100): Layout3D {\r\n            const n = this.nodes.length;\r\n\r\n            var linkAccessor = new LinkAccessor();\r\n\r\n            if (this.useJaccardLinkLengths)\r\n                jaccardLinkLengths(this.links, linkAccessor, 1.5);\r\n\r\n            this.links.forEach(e => e.length *= this.idealLinkLength);\r\n\r\n            // Create the distance matrix that Cola needs\r\n            const distanceMatrix = (new Calculator(n, this.links,\r\n                e=> e.source, e=> e.target, e => e.length)).DistanceMatrix();\r\n\r\n            const D = Descent.createSquareMatrix(n, (i, j) => distanceMatrix[i][j]);\r\n\r\n            // G is a square matrix with G[i][j] = 1 iff there exists an edge between node i and node j\r\n            // otherwise 2.\r\n            var G = Descent.createSquareMatrix(n, function () { return 2 });\r\n            this.links.forEach(({ source, target }) => G[source][target] = G[target][source] = 1);\r\n\r\n            this.descent = new Descent(this.result, D);\r\n            this.descent.threshold = 1e-3;\r\n            this.descent.G = G;\r\n            //let constraints = this.links.map(e=> <any>{\r\n            //    axis: 'y', left: e.source, right: e.target, gap: e.length*1.5\r\n            //});\r\n            if (this.constraints)\r\n                this.descent.project = new Projection(<GraphNode[]>this.nodes, null, null, this.constraints).projectFunctions();\r\n\r\n            for (var i = 0; i < this.nodes.length; i++) {\r\n                var v = this.nodes[i];\r\n                if (v.fixed) {\r\n                    this.descent.locks.add(i, [v.x, v.y, v.z]);\r\n                }\r\n            }\r\n\r\n            this.descent.run(iterations);\r\n            return this;\r\n        }\r\n\r\n        tick(): number {\r\n            this.descent.locks.clear();\r\n            for (var i = 0; i < this.nodes.length; i++) {\r\n                var v = this.nodes[i];\r\n                if (v.fixed) {\r\n                    this.descent.locks.add(i, [v.x, v.y, v.z]);\r\n                }\r\n            }\r\n            return this.descent.rungeKutta();\r\n        }\r\n    }\r\n\r\n    class LinkAccessor implements LinkLengthAccessor<any> {\r\n        getSourceIndex(e: any): number { return e.source; }\r\n        getTargetIndex(e: any): number { return e.target; }\r\n        getLength(e: any): number { return e.length; }\r\n        setLength(e: any, l: number) { e.length = l; }\r\n    }\r\n"]}},"hash":"7dde0fd615c1165147de51477ef027e7","cacheData":{"env":{}}}